name: Automação LinkedIn Post

on:
  workflow_dispatch: # Permite que você clique num botão para testar
  schedule:
    - cron: '0 12 * * *' # Roda automaticamente todos os dias

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Essencial para salvar o progresso no post_index.txt

    steps:
      - name: Checkout do código
        uses: actions/checkout@v3

      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Instalar dependências
        run: pip install google-generativeai requests

      - name: Rodar Script de Postagem
        env:
          # ESTA É A PARTE QUE ESTÁ A FALTAR NO SEU LOG:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          LINKEDIN_ACCESS_TOKEN: ${{ secrets.LINKEDIN_ACCESS_TOKEN }}
        run: python automacao_linkedin.py

      - name: Git Auto-commit (Salvar progresso)
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add post_index.txt
          git commit -m "Atualizando índice de postagem [skip ci]" || echo "Sem alterações"
          git push
